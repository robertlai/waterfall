// Generated by CoffeeScript 1.9.3
(function() {
  var Picture, api, db, express, fs, mongoose, pictureSchema;

  fs = require('fs');

  express = require('express');

  mongoose = require('mongoose');

  db = require('../Utilities/DB');

  api = express.Router();

  pictureSchema = new mongoose.Schema({
    image: Buffer
  });

  Picture = mongoose.model('picture', pictureSchema);

  api.post('/api', function(req, res) {
    var fileLocation, fileWriteStream;
    fileLocation = __dirname + '/../image.JPG';
    fileWriteStream = fs.createWriteStream(fileLocation);
    fileWriteStream.on('finish', function() {
      var picture;
      picture = new Picture;
      picture.image = fs.readFileSync(fileLocation);
      fs.unlinkSync(fileLocation);
      return picture.save(function(err, picture) {
        if (err) {
          throw err;
        }
      }).then(function() {
        return res.sendStatus(200);
      });
    });
    return req.pipe(fileWriteStream);
  });

  api.get('/api', function(req, res) {
    return Picture.find({}, function(err, pictures) {
      return res.json(pictures);
    });
  });

  module.exports = api;

}).call(this);
